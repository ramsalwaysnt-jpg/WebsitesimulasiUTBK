// Data Soal dan Kunci Jawaban
const questionsData = [
    // --- Soal 1-2 (TikTok) ---
    {
        question: "TikTok is often applauded for its recommendation system; once it’s finely tuned, the app becomes one of the best scrolling experiences. My personal theory is that’s why TikTok is so addicting—everything is so perfectly curated to your specific interests, it’s hard to put the phone down once you’re sucked in. However, TikTok’s recommendation algorithm still has its own flaws that the company brings up in its new blog post.\n“One of the inherent challenges with recommendation engines is that they can inadvertently limit user experience–what is sometimes referred to as a ‘filter bubble’,” the post reads. It states that by optimizing for personalization and relevance, there is a risk of presenting an increasingly homogenous stream of videos.\nAnother issue that TikTok takes seriously is not surfacing dangerous content. This is an issue that YouTube in particular has faced criticism over for many years. According to TikTok, content that has graphic material like medical procedures or “legal consumption of regulated goods,” like alcohol, may not be eligible for recommendation because it could come across as “shocking if surfaced as a recommended video to a general audience”. That’s why many creators on TikTok will upload a video more than once or talk openly about feeling shadow banned over particular content.",
        options: {
            A: "illustrate TikTok users’ concerns about the app’s recommendation system",
            B: "oppose the idea that TikTok has a sophisticated recommendation system",
            C: "warn the readers about TikTok’s poor recommendation system",
            D: "inform about the downsides of TikTok’s recommendation system",
            E: "explain how TikTok resolves the recommendation system issue"
        },
        answer: "D" 
    },
    {
        question: "The writer of the passage intends to …",
        options: {
            A: "Video creators on TikTok will avoid creating dangerous content.",
            B: "TikTok will be considered a safer social media platform compared to YouTube.",
            C: "Videos with sensitive content can only be recommended for a specific scope of viewers.",
            D: "Other social media platforms will look up to TikTok for its good recommendation system.",
            E: "Users will be exposed to topics outside their preferences in their recommendation feeds."
        },
        answer: "C" 
    },

    // --- Soal 3-5 (Feline Chlamydial Conjunctivitis) ---
    {
        question: "Feline chlamydial conjunctivitis is an infection caused by a bacterial organism (called Chlamydophila felis). The most common signs of chlamydia in cats involve the eyes or the upper respiratory tract (nose or throat), and only when infection is not treated does it spread to the lungs. Because chlamydia lives inside cells of the body and is not able to survive for long in the environment, spread of infection relies on direct or close contact with an infected cat. Following infection, the incubation period (the time between infection and development of clinical signs of disease) is between three and ten days.\nThe bacteria primarily infects the conjunctiva, which are the delicate membranes lining the eyelids and covering the edges of the eyeballs. The infection causes inflammation known as conjunctivitis. In normal cats, the conjunctiva is not readily visible and has a pale, salmon pink color. In cats with conjunctivitis, the conjunctiva becomes swollen and red, making it more visible. The nictitating membrane or third eyelid in the inner corner of the eye may protrude partially across the eye. One or both eyes may be involved.\nAffected cats initially develop a watery discharge from the eyes that quickly becomes thicker and is usually a yellow or greenish color. The eyes are uncomfortable and cats often keep the affected eye(s) closed. Many cats remain bright and otherwise appear normal, but some may develop a fever or lose their appetite. After one or two days, sniffles and sneezing may also occur. In kittens, the infection may spread to the lungs and cause fatal pneumonia.",
        options: {
            A: "the process of chlamydia affliction in cats",
            B: "an overview of feline chlamydial conjunctivitis",
            C: "clinical signs of feline chlamydial conjunctivitis",
            D: "the symptoms of feline chlamydial conjunctivitis",
            E: "treatments for cats with chlamydia conjunctivitis"
        },
        answer: "B" 
    },
    {
        question: "What does the text mainly deal with?",
        options: {
            A: "the process of chlamydia affliction in cats",
            B: "an overview of feline chlamydial conjunctivitis",
            C: "clinical signs of feline chlamydial conjunctivitis",
            D: "the symptoms of feline chlamydial conjunctivitis",
            E: "treatments for cats with chlamydia conjunctivitis"
        },
        answer: "B" 
    },
    {
        question: "One of the symptoms of feline chlamydial conjunctivitis is ….",
        options: {
            A: "eating disorder",
            B: "laboured breathing",
            C: "low body temperature",
            D: "abnormal eye discharge",
            E: "dysfunctional eye membrane"
        },
        answer: "D" 
    },

    // --- Soal 6-8 (Supply Chain & Hybrid Vehicles) ---
    {
        question: "Supply chain weaknesses were brought to the forefront during the COVID-19 pandemic, especially for industries relying on electronics, as the flow of raw materials slowed or sometimes stopped. On top of that, shifting consumer values and tougher environmental regulations have resulted in more people buying hybrid vehicles. The batteries in these cars require rare metals that, depending on their supplies, can have volatile and unpredictable prices. However, there are other scarce elements and materials that may be used in smaller amounts in hybrid models versus conventional gas vehicles, raising the question of how these vehicles really compare with regard to supply chain vulnerabilities. Randolph Kirchain and colleagues wanted to develop a comprehensive comparison of the elements and compounds that go into all the parts in gas-powered, self-charging hybrid and plug-in hybrid cars, calculating each of the three vehicles’ materials cost vulnerability.\nThe researchers collected information on the compounds in the more than 350,000 parts used to build seven vehicles from the same manufacturer with different levels of electrification, including four sedans and three sport utility vehicles (SUVs). Then, they calculated the amount of the 76 chemical elements present, as well as a few other materials, in each car type. To develop a monetary metric for vulnerability, the team considered the weight of each component, along with its average price and price volatility between 1998 and 2015. The results showed that self-charging hybrid and plug-in hybrid vehicles have twice the raw material cost risks. The largest contributors to the increase in cost risks were battery-related elements, such as cobalt, nickel, graphite and neodymium. The researchers say that as manufacturers ramp up electric vehicle production to meet demand, reducing raw material cost risks with long-term supplier contracts, substituting some materials or recycling others will be a good idea.",
        options: {
            A: "pricey",
            B: "exorbitant",
            C: "invaluable",
            D: "overpriced",
            E: "economical"
        },
        answer: "A" 
    },
    {
        question: "According to the passage, due to the raw components, the buyers will find a hybrid vehicle ….",
        options: {
            A: "pricey",
            B: "exorbitant",
            C: "invaluable",
            D: "overpriced",
            E: "economical"
        },
        answer: "A" 
    },
    {
        question: "How does the author organize the ideas in paragraph 1 and 2?",
        options: {
            A: "Paragraph 2 exemplifies issues stated in paragraph 1.",
            B: "Paragraph 2 contains a solution to the issue addressed in paragraph 1.",
            C: "Paragraph 2 asserts the weakness of hybrid vehicles explained in paragraph 1.",
            D: "Paragraph 2 reveals the reasons behind the research on vehicles introduced in paragraph 1.",
            E: "Paragraph 2 explains further about research on gas-powered and hybrid vehicles mentioned in paragraph 1."
        },
        answer: "E" 
    },

    
    // --- Soal 10-12 (Loneliness in Older Adults) ---
    {
        question: "Loneliness and social isolation in older adults are serious public health risks affecting a significant number of people in the United States and putting them at risk for dementia and other serious medical conditions. A report from the National Academies of Sciences, Engineering, and Medicine (NASEM) points out that more than one-third of adults aged 45 and older feel lonely, and nearly one-fourth of adults aged 65 and older are considered to be socially isolated. Older adults are at increased risk for loneliness and social isolation because they are more likely to face factors such as living alone, the loss of family or friends, chronic illness, and hearing loss.\nAlthough it’s hard to measure social isolation and loneliness precisely, there is strong evidence that many adults aged 50 and older are socially isolated or lonely in ways that put their health at risk. Recent studies found that social isolation significantly increased a person’s risk of premature death from all causes, a risk that may rival those of smoking, obesity, and physical inactivity. Poor social relationships (characterized by social isolation or loneliness) was also associated with a 29% increased risk of heart disease. Loneliness among heart failure patients was associated with a nearly 4 times increased risk of death, 68% increased risk of hospitalization, and 57% increased risk of emergency department visits.",
        options: {
            A: "disseminate the information about the impacts loneliness and social isolation in the elderly",
            B: "encourage people to be more concerned about the elderly who are lonely and socially isolated",
            C: "prove that the elderly experiencing loneliness and social isolation actually exist in the United States",
            D: "convey the pain and sadness experienced by lonely and socially isolated elderly based on research",
            E: "tell about the loneliness and unhappiness felt by the elderly who are socially isolated, as well as research findings"
        },
        answer: "A" 
    },
    {
        question: "The writer’s intention in writing the passage is to ….",
        options: {
            A: "disseminate the information about the impacts loneliness and social isolation in the elderly",
            B: "encourage people to be more concerned about the elderly who are lonely and socially isolated",
            C: "prove that the elderly experiencing loneliness and social isolation actually exist in the United States",
            D: "convey the pain and sadness experienced by lonely and socially isolated elderly based on research",
            E: "tell about the loneliness and unhappiness felt by the elderly who are socially isolated, as well as research findings"
        },
        answer: "A" 
    },
    {
        question: "To whom is the text likely addressed?",
        options: {
            A: "Families staying with elderly",
            B: "People living around elderly",
            C: "Pensioners who have just left their jobs",
            D: "Senior citizens living alone in the suburbs",
            E: "Employers having old workers in their companies"
        },
        answer: "A" 
    },
    {
        question: "From the last paragraph, we can infer that …",
        options: {
            A: "Those who experience loneliness may develop heart disease.",
            B: "Feeling lonely aggravates the heart condition of the elderly.",
            C: "Heart disease is the worst ailment that a lonely older person will suffer from.",
            D: "The older people get, the more lonely they will feel.",
            E: "Loneliness and social isolation that people experience makes them unable to survive."
        },
        answer: "B" 
    },

    // --- Soal 13-16 (Retail Industry Digital Transformation) ---
    {
        question: "Those in the retail industry that are successful in digitally transforming will be ones that leverage technology to innovate around an immersive and disruptive customer experience. These “lighthouse” retailers are the ones driving innovation, adopting emerging technologies early, and showing the industry what works and is possible. They are the ones experimenting with new models and store formats, playing with recombinations/reconfigurations of scale, assets, product, place, and people. The “store of the future” is the keystone of this effort.\nThe store of the future will combine multiple formats to deliver an immersive and unique experience across all customer touchpoints online and in the store. It will be heavily instrumented for operational efficiency and digitally connected end-to-end to leverage a single view of customer, product, and order. The store of the future – despite its reliance on sophisticated technology and infrastructure – will be trying to look smaller and less intimidating, more personalized, and frictionless.\nThe deployment of these and other digital technologies in disruptive ways can turn visitors into shoppers and shoppers into brand-loyal customers. However, understanding which consumers want personalization and which want contextualized and relevant experiences, while protecting everyone’s privacy, has grown more difficult. With so much at stake, data privacy has become a challenge for every party involved.",
        options: {
            A: "Online customerz",
            B: "Businessperson",
            C: "Manufacturer",
            D: "Importer",
            E: "Distributor"
        },
        answer: "B" 
    },
    {
        question: "Who needs to see the passage?",
        options: {
            A: "Online customerz",
            B: "Businessperson",
            C: "Manufacturer",
            D: "Importer",
            E: "Distributor"
        },
        answer: "B" 
    },
    {
        question: "Which of the following statements is correct?",
        options: {
            A: "Customers demanded stores with cutting-edge infrastructure to be user-friendly.",
            B: "The more advanced the technology is, the more successful the retailers will be.",
            C: "Each customer will receive a better and more unique experience in online shopping.",
            D: "Providing a one-of-a-kind shopping experience will require a combination of formats.",
            E: "Stores of the future are trying to achieve the ultimate goal that is to attract more visitors."
        },
        answer: "D" 
    },
    {
        question: "What is the subject of the passage?",
        options: {
            A: "The emerging technology-specific change in retail industries",
            B: "Digital transformation strategies and initiatives for retail organizations",
            C: "The digitalization of retail business to push towards its improvements",
            D: "The qualities of retailers in succeeding their digital transformation plans",
            E: "Different ways of digital transformation in redefining retail stores"
        },
        answer: "C" 
    },

    // --- Soal 17-21 (IPR Center & Counterfeit Goods) ---
    {
        question: "The holiday shopping season is underway, and the National Intellectual Property Rights Coordination Center (IPR Center) is launching a new holiday shopping toolkit to help consumers protect themselves from substandard or even hazardous counterfeit products. The holiday shopping toolkit includes online shopping do’s and don’ts, ways to protect financial and banking information, educational videos and infographics, and general information on how to spot fake merchandise. IPR Center partners Homeland Security Investigations, Customs and Border Protection (CBP), Federal Bureau of Investigations (FBI) and The Toy Association are teaming up to ensure consumers can make educated decisions when searching for the best deals this season.\nWhat’s the risk of buying counterfeit products? Counterfeit electronics can overheat and explode, bicycle helmets can break upon impact, phony cosmetics and health care products can be made with dangerous or unsanitary ingredients that should not be applied to the skin, and seasonal items for the home, like holiday lights, can be poorly wired and ignite fires. Counterfeit goods not only cheat the consumer with substandard and potentially hazardous products, but the websites used can also put shoppers at risk of having their personal and financial data stolen for other nefarious purposes. Online shopping is particularly vulnerable to scams that trick the user into buying counterfeit and pirated goods.\nThe IPR Center, working collaboratively with its 27 public and private sector partners, stands at the forefront of the United States government’s response to combatting global intellectual property theft and enforcing intellectual properties rights violations. The IPR Center was established to combat global intellectual property theft and, accordingly, has a significant role policing the sale and distribution of counterfeit goods on websites, social media, and the dark web. These efforts protect U.S. industry, the U.S. consumer, and the safety of the American public from the adverse economic impact and health dangers posed from introducing counterfeit products into U.S. commerce.",
        options: {
            A: "warn the readers how vulnerable online shopping can be for them",
            B: "raise awareness of the dangers of fake goods that harm consumers",
            C: "let the public know the IPR’s latest effort to combat counterfeit goods",
            D: "inform the problems that can result from purchasing counterfeit products",
            E: "explain why counterfeit products are risky and should be avoided by the IPR"
        },
        answer: "C" 
    },
    {
        question: "The purpose of the passage is to ….",
        options: {
            A: "warn the readers how vulnerable online shopping can be for them",
            B: "raise awareness of the dangers of fake goods that harm consumers",
            C: "let the public know the IPR’s latest effort to combat counterfeit goods",
            D: "inform the problems that can result from purchasing counterfeit products",
            E: "explain why counterfeit products are risky and should be avoided by the IPR"
        },
        answer: "C" 
    },
    {
        question: "The word **nefarious** in paragraph 2 is closest in meaning to ….",
        options: {
            A: "evil",
            B: "virtuous",
            C: "irritating",
            D: "damaging",
            E: "troublesome"
        },
        answer: "A" 
    },
    {
        question: "With ideas in paragraph 3, it can be predicted that …",
        options: {
            A: "The number of people addicted to counterfeit goods will dwindle.",
            B: "Americans will be able to shop wisely on online shopping platforms.",
            C: "The perpetrators of buying and selling fake products will be arrested.",
            D: "More people would place a higher value on intellectual property.",
            E: "Counterfeit items will be less widely distributed in the USA."
        },
        answer: "E" 
    },
    {
        question: "The ideas in the passage may be best summarized that …",
        options: {
            A: "The IPR Center publishes a new holiday shopping kit in the US.",
            B: "The IPR Center prevents counterfeit goods from entering the United States.",
            C: "The IPR’s new holiday shopping kit campaign seeks to encourage American to actively combat counterfeit items.",
            D: "The IPR Center released a new holiday shopping toolkit intended to protect Americans from purchasing counterfeit goods.",
            E: "A new holiday shopping kit has been released in the USA by the IPR Center to fight global intellectual property theft."
        },
        answer: "D" 
    },

    // --- Soal 22-24 (Operation Cottage) ---
    {
        question: "Operation Cottage was a tactical maneuver which completed the Aleutian Islands campaign. On August 15, 1943, Allied military forces landed on Kiska Island, which had been occupied by Japanese forces since June, 1942. The Japanese, however, had secretly abandoned the island two weeks prior, and so the Allied landings were unopposed. Despite this, Allied forces suffered well over 200 casualties during the operation, mostly due to Japanese mines and the difficult terrain.\nThe Japanese under Captain Takeji Ono had landed on Kiska at approximately 01:00 on June 7, 1942, with a force of about 500 Japanese marines. Soon after arrival, they stormed an American weather station. Here they killed two and captured eight United States Navy officers. The remaining eight were sent to Japan as prisoners of war. Another 2,000 Japanese troops arrived, landing in Kiska Harbor. At this time, Monzo Akiyama, a Rear-Admiral, headed the force on Kiska. In December 1942, additional anti-aircraft units, engineers, and a negligible number of reinforcement infantry arrived on the island. In the spring of 1943, control was transferred to Kiichiro Higuchi.\nA Consolidated B-24 Liberator aircraft sighted Japanese ships in Kiska. No further identification was visible. To United States naval planners, none was necessary and the orders to invade Kiska soon followed.\nDue to the heavy casualties suffered at Attu Island, planners were expecting another costly operation. The Japanese tactical planners had, however, realized the isolated island was no longer defensible and planned for an evacuation. Although small, there were signs of Japanese retreat. Anti-aircraft guns, once active during the Kiska Blitz, were silent when Allied planes flew over in the days leading up to the invasion.\nOn August 15, 1943, the 7th Division (U.S.) and the 13th Infantry Brigade (Canada), landed on opposite shores of Kiska. Both US and Canadian forces mistook each other as Japanese and as a result friendly fire incidents killed 28 Americans and 4 Canadians and wounded 50 more. A stray Japanese mine caused the USS Abner Read (DD-526) to lose a large chunk of its stern. The blast killed 71. 191 troops went missing during the two-day stay on the island and presumably also died from friendly fire. Four other troops had also been killed by landmines or other traps.",
        options: {
            A: "attacked the U.S. military officers",
            B: "killed eight United States Navy officers",
            C: "destroyed the American weather station",
            D: "occupied the United States weather station",
            E: "planned to target the American weather station"
        },
        answer: "D" 
    },
    {
        question: "Right after the Japanese arrived on Kiska, they ….",
        options: {
            A: "attacked the U.S. military officers",
            B: "killed eight United States Navy officers",
            C: "destroyed the American weather station",
            D: "occupied the United States weather station",
            E: "planned to target the American weather station"
        },
        answer: "D" 
    },
    {
        question: "Operation Cottage resulted in high casualties for the Allied forces mainly because of ….",
        options: {
            A: "fierce resistance from the remaining Japanese forces",
            B: "surprise attacks launched by the Japanese navy",
            C: "unpredictable Japanese landmines and difficult terrain",
            D: "the Japanese forces' secret evacuation plan",
            E: "a naval battle near the USS Abner Read"
        },
        answer: "C" 
    },
    // --- Tambahan Soal untuk Mencapai 30 ---
    {
        question: "The primary purpose of the text about Operation Cottage is to ….",
        options: {
            A: "describe the process of Japanese evacuation from Kiska.",
            B: "explain the reasons behind the large number of Allied casualties.",
            C: "detail the events of the Allied landing on Kiska Island.",
            D: "highlight the success of the Aleutian Islands campaign.",
            E: "analyze the strategic importance of the Kiska operation."
        },
        answer: "C" 
    },
    {
        question: "The word 'negligible' in paragraph 2 is closest in meaning to ….",
        options: {
            A: "significant",
            B: "minor",
            C: "powerful",
            D: "effective",
            E: "substantial"
        },
        answer: "B" 
    },
    {
        question: "What lesson can be learned from the friendly fire incidents during Operation Cottage?",
        options: {
            A: "Allied forces were poorly trained for ground combat.",
            B: "Lack of clear identification between friendly forces can lead to tragic errors.",
            C: "Japanese mines were the most dangerous threat to the landing troops.",
            D: "The use of naval support was insufficient during the operation.",
            E: "Evacuation of enemy forces always leads to confusion for the invaders."
        },
        answer: "B" 
    },
    {
        question: "Based on paragraph 4, what contributed to the misjudgment by US naval planners regarding the invasion's cost?",
        options: {
            A: "The successful concealment of the Japanese evacuation.",
            B: "The sighting of Japanese ships by a reconnaissance aircraft.",
            C: "The silence of Japanese anti-aircraft guns before the invasion.",
            D: "The heavy casualties suffered in a previous battle (Attu Island).",
            E: "The unexpected presence of landmines on Kiska."
        },
        answer: "D" 
    },
    {
        question: "Which of the following elements *was not* a major contributor to the raw material cost risks of hybrid vehicles, according to the second paragraph of the supply chain text?",
        options: {
            A: "Cobalt",
            B: "Nickel",
            C: "Graphite",
            D: "Neodymium",
            E: "Steel"
        },
        answer: "E" 
    },
    {
        question: "What is the primary risk associated with buying counterfeit products mentioned in paragraph 2 of the IPR text?",
        options: {
            A: "The quality of the product being too high.",
            B: "The product being environmentally friendly.",
            C: "Physical safety and financial data theft.",
            D: "The seller being easily traced by authorities.",
            E: "The price of the counterfeit product being too low."
        },
        answer: "C" 
    }
];

// Memastikan jumlah soal sudah 30
console.assert(questionsData.length === 30, `Jumlah soal seharusnya 30, ditemukan ${questionsData.length}`);

// Status Ujian
let currentQuestionIndex = 0;
const totalQuestions = questionsData.length;
const studentAnswers = Array(totalQuestions).fill(null); 
const flaggedStatus = Array(totalQuestions).fill(false); 
let timerInterval;
let totalTimeSeconds = 90 * 60; // 90 menit dalam detik

// --- Elemen DOM ---
const loginPage = document.getElementById('login-page');
const examPage = document.getElementById('exam-page');
const resultPage = document.getElementById('result-page');
const loginForm = document.getElementById('login-form');
const loginError = document.getElementById('login-error');
const questionDisplay = document.getElementById('question-display');
const prevBtn = document.getElementById('prev-btn');
const nextBtn = document.getElementById('next-btn');
const raguRaguBtn = document.getElementById('ragu-ragu-btn');
const finishExamBtn = document.getElementById('finish-exam');
const questionNavPanel = document.getElementById('question-nav-panel');
const timerDisplay = document.getElementById('timer-display'); 

// --- 1. Halaman Login ---
loginForm.addEventListener('submit', function(e) {
    e.preventDefault();
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    const correctPassword = 'admin123'; // Password yang disyaratkan

    if (password === correctPassword) {
        // Login Berhasil
        loginPage.style.display = 'none';
        examPage.style.display = 'flex'; // Tampilkan halaman ujian
        loginError.style.display = 'none';
        
        initializeExam();
        startTimer();
    } else {
        // Login Gagal
        loginError.style.display = 'block';
    }
});

// --- 2. Inisialisasi Ujian ---
function initializeExam() {
    createQuestionNavigation(); // Buat panel navigasi soal
    loadQuestion(currentQuestionIndex); // Muat soal pertama
}

// --- 3. Panel Navigasi Soal ---
function createQuestionNavigation() {
    questionNavPanel.innerHTML = '';
    for (let i = 0; i < totalQuestions; i++) {
        const navItem = document.createElement('div');
        navItem.className = 'q-nav-item status-default';
        navItem.textContent = i + 1;
        navItem.dataset.index = i;
        navItem.addEventListener('click', () => {
            saveCurrentAnswer();
            loadQuestion(i);
        });
        questionNavPanel.appendChild(navItem);
    }
    updateNavigationPanel(); // Set status awal (aktif)
}

function updateNavigationPanel() {
    const navItems = questionNavPanel.querySelectorAll('.q-nav-item');
    navItems.forEach((item, index) => {
        item.className = 'q-nav-item';
        
        let statusClass = 'status-default';
        if (studentAnswers[index] !== null) {
            statusClass = 'status-answered';
        }
        
        if (flaggedStatus[index]) {
            statusClass = (studentAnswers[index] !== null) ? 'status-answered status-flagged' : 'status-flagged';
        }
        
        if (index === currentQuestionIndex) {
            statusClass += ' status-active';
            // Update tombol ragu-ragu
            raguRaguBtn.textContent = flaggedStatus[index] ? 'Batalkan Ragu-Ragu' : 'Ragu-Ragu';
        }

        item.classList.add(...statusClass.split(' '));
    });
}

// --- 4. Memuat Soal ---
function loadQuestion(index) {
    currentQuestionIndex = index;
    const q = questionsData[index];
    
    let html = `
        <h3 class="question-title">Soal No. ${index + 1} dari ${totalQuestions}</h3>
        <p class="question-text">${q.question}</p>
        <div class="options">
    `;
    
    // Generate Opsi Jawaban
    const options = ['A', 'B', 'C', 'D', 'E'];
    options.forEach(optionKey => {
        const checked = studentAnswers[index] === optionKey ? 'checked' : '';
        html += `
            <label>
                <input type="radio" name="answer" value="${optionKey}" ${checked}>
                <span>${optionKey}. ${q.options[optionKey]}</span>
            </label>
        `;
    });
    
    html += `</div>`;
    questionDisplay.innerHTML = html;
    
    // Tambahkan listener untuk menyimpan jawaban saat opsi diubah
    document.querySelectorAll('input[name="answer"]').forEach(radio => {
        radio.addEventListener('change', saveCurrentAnswer);
    });
    
    // Update tombol navigasi
    prevBtn.style.display = index > 0 ? 'inline-block' : 'none';
    nextBtn.style.display = index < totalQuestions - 1 ? 'inline-block' : 'none';

    updateNavigationPanel();
}

// --- 5. Menyimpan Jawaban Siswa ---
function saveCurrentAnswer() {
    const selectedOption = document.querySelector('input[name="answer"]:checked');
    studentAnswers[currentQuestionIndex] = selectedOption ? selectedOption.value : null;
    updateNavigationPanel();
}

// --- 6. Navigasi Soal (Lanjut/Kembali) ---
prevBtn.addEventListener('click', () => {
    if (currentQuestionIndex > 0) {
        saveCurrentAnswer();
        loadQuestion(currentQuestionIndex - 1);
    }
});

nextBtn.addEventListener('click', () => {
    if (currentQuestionIndex < totalQuestions - 1) {
        saveCurrentAnswer();
        loadQuestion(currentQuestionIndex + 1);
    } else {
        // Opsi: Jika soal terakhir, langsung tampilkan tombol 'Selesai' lebih menonjol
    }
});

// --- 7. Fitur Ragu-Ragu ---
raguRaguBtn.addEventListener('click', () => {
    flaggedStatus[currentQuestionIndex] = !flaggedStatus[currentQuestionIndex];
    updateNavigationPanel(); // Perbarui tampilan panel navigasi
});

// --- 8. Timer Hitung Mundur ---
function startTimer() {
    const startTime = Date.now();
    const totalDuration = totalTimeSeconds * 1000;

    timerInterval = setInterval(() => {
        const elapsedTime = Date.now() - startTime;
        const remainingTimeMs = totalDuration - elapsedTime;
        
        if (remainingTimeMs <= 0) {
            clearInterval(timerInterval);
            timerDisplay.textContent = 'WAKTU HABIS!';
            handleSubmit(true); // Kirim otomatis saat waktu habis
            return;
        }
        
        const seconds = Math.floor(remainingTimeMs / 1000);
        const h = Math.floor(seconds / 3600);
        const m = Math.floor((seconds % 3600) / 60);
        const s = seconds % 60;
        
        const display = `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
        // Mengupdate elemen timer yang baru
        timerDisplay.textContent = display;
        
    }, 1000);
}

// --- 9. Pengiriman Jawaban (Submit) ---
finishExamBtn.addEventListener('click', () => {
    // Konfirmasi sebelum submit
    if (confirm("Apakah Anda yakin ingin menyelesaikan ujian? Anda tidak dapat kembali ke halaman soal setelah ini.")) {
        handleSubmit(false);
    }
});

function handleSubmit(timeUp) {
    saveCurrentAnswer(); // Simpan jawaban terakhir
    clearInterval(timerInterval); // Hentikan timer
    
    // Hitung Waktu Pengerjaan
    const timeRemainingText = timerDisplay.textContent;
    let totalSecondsSpent;

    if (timeUp) {
        totalSecondsSpent = totalTimeSeconds;
    } else {
        // Ambil sisa waktu dari tampilan timer
        const parts = timeRemainingText.split(':');
        if (parts.length === 3) {
            const remainingH = parseInt(parts[0]);
            const remainingM = parseInt(parts[1]);
            const remainingS = parseInt(parts[2]);
            const remainingSeconds = remainingH * 3600 + remainingM * 60 + remainingS;
            totalSecondsSpent = totalTimeSeconds - remainingSeconds;
        } else {
            totalSecondsSpent = totalTimeSeconds; // Fallback jika format timer salah
        }
    }


    // Hitung Hasil
    let correct = 0;
    let wrong = 0;
    let unanswered = 0;
    
    questionsData.forEach((q, index) => {
        const studentAns = studentAnswers[index];
        if (studentAns === null) {
            unanswered++;
        } else if (studentAns === q.answer) {
            correct++;
        } else {
            wrong++;
        }
    });
    
    // Tampilkan Halaman Hasil
    examPage.style.display = 'none';
    resultPage.style.display = 'flex';
    
    // Update Hasil di Halaman Hasil
    document.getElementById('result-correct').textContent = correct;
    document.getElementById('result-wrong').textContent = wrong;
    document.getElementById('result-unanswered').textContent = unanswered;

    const spentH = Math.floor(totalSecondsSpent / 3600);
    const spentM = Math.floor((totalSecondsSpent % 3600) / 60);
    const spentS = totalSecondsSpent % 60;
    document.getElementById('time-spent-info').textContent = `Waktu pengerjaan: ${String(spentH).padStart(2, '0')} jam ${String(spentM).padStart(2, '0')} menit ${String(spentS).padStart(2, '0')} detik.`;
}

// Jalankan inisialisasi awal (sebelum login)
// Pastikan hanya halaman login yang ditampilkan di awal.